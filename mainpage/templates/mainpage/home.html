{% extends "base.html" %}
{% load descontos %}

{% block title %}Bem-vindo ao Verdi Market{% endblock %}

{% block content %}

<header class="mainpage-hero">
    <h1>Bem-vindo ao Verdi Market</h1>
    <p>Conectando você aos melhores produtos da agricultura familiar</p>
</header>

<main class="mainpage-container">
    <h2 class="mainpage-section-title">Produtos em Destaque</h2>
    <div class="mainpage-carousel-wrapper">
    <button class="mainpage-carousel-btn left" id="btn-left" onclick="scrollCarousel(-1)" style="display: none;">‹</button>

    <div class="mainpage-carousel" id="produtoCarousel">
        {% for produto in produtos %}
        <div class="mainpage-produto-card">
            <a href="{% url 'produto_detalhe' produto.id %}" class="mainpage-link">
                <div class="mainpage-card">
                    <img src="{{ produto.imagem.url }}" class="mainpage-card-img" alt="{{ produto.nome }}">
                    <div class="mainpage-card-body">
                        <h5 class="mainpage-card-title">{{ produto.nome }}</h5>
                        <p class="mainpage-card-descricao">{{ produto.descricao|truncatewords:10 }}</p>

                        {% with preco_final=produto.preco_com_desconto %}
                            {% if preco_final < produto.preco %}
                                <p class="mainpage-preco-antigo">R$ {{ produto.preco }}</p>
                                <p class="mainpage-preco">R$ {{ preco_final|floatformat:2 }}</p>
                                <span class="mainpage-desconto-badge">
                                    -{{ produto.preco|percentual_desconto:preco_final }}%
                                </span>
                            {% else %}
                                <p class="mainpage-preco">R$ {{ produto.preco }}</p>
                            {% endif %}
                        {% endwith %}

                        <span class="mainpage-categoria">{{ produto.categoria.nome }}</span>
                    </div>
                    <div class="mainpage-card-footer">
                        Vendido por: {{ produto.vendedor.nome }}
                    </div>
                </div>
            </a>
        </div>
        {% endfor %}
    </div>

    <button class="mainpage-carousel-btn right" onclick="scrollCarousel(1)">›</button>


    </div>
</main>

{% endblock %}

{% block scripts %}
<script>
  const carousel = document.getElementById('produtoCarousel');
  const btnLeft = document.getElementById('btn-left');

  function scrollCarousel(direction) {
    const scrollAmount = 300;
    carousel.scrollBy({ left: direction * scrollAmount, behavior: 'smooth' });
  }

  function updateCarouselButtons() {
    // Se o scroll da esquerda for maior que zero, mostra a seta
    if (carousel.scrollLeft > 10) {
      btnLeft.style.display = 'block';
    } else {
      btnLeft.style.display = 'none';
    }
  }

  // Atualiza ao rolar
  carousel.addEventListener('scroll', updateCarouselButtons);

  // Garante atualização após scroll programático
  carousel.addEventListener('wheel', updateCarouselButtons);

  // Também quando a página termina de carregar
  window.addEventListener('load', updateCarouselButtons);
</script>

{% endblock %}
